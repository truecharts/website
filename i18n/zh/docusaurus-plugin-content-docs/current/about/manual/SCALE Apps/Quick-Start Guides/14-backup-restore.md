# 14-备份和恢复

## B. 所需经费

本指南使用我们的命令行工具，名为 `TrueTool`。

这应该通过使用以下方法安装： `pip安装truetool`

请注意这需要在每次TrueNAS SCALE 更新后重新安装。

## 备份

### 创建手动备份

手动备份可以轻松使用 TrueTool。

`truetool-b`

它会自动删除过多的备份，这些备份默认为最多14个备份。 若要增加这个值，请使用：

`truetool-b 31`

这也可以很容易地与 TrueTool update, sync, prune 等组合，如：

`truetool-b 31 -u -s -p`

要找出以前备份的内容，您可以运行以下命令：

`truetool-l`

### 创建常用备份

SCALE 包括一个集成系统备份Kubernetes 对象，并制作 `PVC` 和 `ix_volume` 存储的快照。 然而，它并不是在升级的基础上创建的。

要创建每日备份的 Kubernetes 对象，您想要运行的 TrueTool 命令，在SCALE UI 中创建一个 Cron Job。 如果您想要确保TrueTool 自动更新和/或(重新)在TrueNAS SCALE 更新后，您可以使用：

`pip安装--no-cache-dir --upgrade truetool && truetool-b -s -u -a -p`

### 导出备份

以上只能创建一个 kubernetes 对象的备份和 `PVC` 和 `ix_volume` 存储的快照。 这些备份保存在相同的 ix_applications 数据集中。

例如，它没有保护这些数据集或在外部系统上保存这些数据。

我们 **为内部备份(在同一系统上单独的数据集) *和* 为离站备份提供了高度** 咨询意见。 可以创建正常递归(! 使用 SCALE 图形复制 `ix-volume` 数据集 通过编辑创建后复制来使用以下几个特殊的技巧：

要做到这一点，请设置以下复制任务：

1[rep1](/img/backup/rep1.png) 1[rep2](/img/backup/rep2.png)

同样重要的是确保您保持SCALE系统本身的定期配置备份，最好是在上面的应用程序备份之后。 但这不是本指南的一部分，我们将假定你自己已经这样做。

### 正在检查备份

要做出存在备份的准备，可以在外壳中使用以下命令：

`truetool-l`

## 恢复

备份的最重要部分之一是确保能够恢复。 有两个场景可以还原：

1. 恢复工作系统

2. 全部系统恢复

### 恢复正在运行的系统

还原一个运行中的系统是微不足道的。 但有几点告诫：

- 这将重新初始化Kubernetes节点，这意味着所有未使用应用系统部署的 kubernetes 对象将被恢复
- 您不能恢复单个应用程序

为了恢复现有的制度，该过程如下：

1. 使用 `truetool-l` 列出您当前的备份

2. 选择备份以恢复并注明它的名称

3. 运行: `truetool-r BACKUPNAME` (在这个地方你用你选择的备份名称替换BACKUPNAME

请记住这可能会花费一个LONG时间。

### 全部还原系统

有时候你需要擦除你的池，迁移到一个新池，或者完全还原系统。 采取上述步骤是非常可能的。

0. 尚未启动 (选择一个池) 应用程序系统。

1. 可选：当SCALE 系统本身也被擦除时，确保先使用 SCALE 配置导出 **** 还原它。

2. 使用 ZFS 复制，将返回先前备份的 `ix-applications` 数据集。

3. 继续使用 `上列出的步骤来恢复一个运行中的系统`

## 视频指南

待办事项
